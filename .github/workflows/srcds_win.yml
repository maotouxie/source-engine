name: win-test

on:
  push:
    branches:
      - "*"
  pull_request:
    branches:
      - "*"

jobs:
  build-mod-64bit:
    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v3
    - name: Build-hl2mp_cstrike_hl1
      run: |
        mkdir win
        mkdir win/hl2mp
        mkdir win/hl1
        mkdir win/hl1mp
        mkdir win/cstrike
        git submodule init;git submodule update
        waf.bat configure -T release -8 --prefix=win/cstrike --disable-warns --build-game=cstrike 
        waf.bat install --target=server -j4
        waf.bat configure -T release -8 --prefix=win/hl2mp --disable-warns --build-game=hl2mp 
        waf.bat install --target=server -j4
        waf.bat configure -T release -8 --prefix=win/hl1 --disable-warns --build-game=hl1 
        waf.bat install --target=server -j4
        waf.bat configure -T release -8 --prefix=win/hl1mp --disable-warns --build-game=hl1mp
        #test hldms
        waf.bat install --target=server -j4
        #mv win/lib win/cstrike
        # cat build/config.log >win/info.txt
        
    - uses: actions/upload-artifact@v3
      with:
        name: 64bit-mod_x4
        path: win
        if-no-files-found: error

  build-srceng-x86_64_dedicated:
    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v3
    - name: build
      run: |
        mkdir win
        git submodule init;git submodule update
        waf.bat configure -T release -8 --prefix=win --disable-warns -d
        waf.bat install -j4
        # cat build/config.log > win/info.txt
    - uses: actions/upload-artifact@v3
      with:
        name: 64bit-srceng-dedicated
        path: win
        if-no-files-found: error

  build-mod-32bit-server:
    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v3
    - name: Build-hl2mp_cstrike_hl1
      run: |
        mkdir win
        mkdir win/hl2mp
        mkdir win/hl1
        mkdir win/hl1mp
        mkdir win/cstrike
        git submodule init;git submodule update
        waf.bat configure -T release --prefix=win/cstrike --disable-warns --build-game=cstrike 
        waf.bat install --target=server -j4
        waf.bat configure -T release --prefix=win/hl2mp --disable-warns --build-game=hl2mp 
        waf.bat install --target=server -j4
        waf.bat configure -T release --prefix=win/hl1 --disable-warns --build-game=hl1 
        waf.bat install --target=server -j4
        waf.bat configure -T release  -prefix=win/hl1mp --disable-warns --build-game=hl1mp
        #test hldms
        waf.bat install --target=server -j4
        #mv win/lib win/cstrike
        # cat build/config.log >win/info.txt
        
    - uses: actions/upload-artifact@v3
      with:
        name: 32bit-mod_x4
        path: win
        if-no-files-found: error

  build-srceng-x86-dedicated:
    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v3
    - name: build
      run: |
        mkdir win
        git submodule init;git submodule update
        waf.bat configure -T release --prefix=win --disable-warns -d
        waf.bat install -j4
        # cat build/config.log > win/info.txt
    - uses: actions/upload-artifact@v3
      with:
        name: 32bit-srceng-dedicated
        path: win
        if-no-files-found: error
